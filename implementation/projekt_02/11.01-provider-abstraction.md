# 11.01 Provider Abstraktion

## Ziel
Implementierung einer einheitlichen Abstraktionsschicht für verschiedene AI Provider (OpenAI, Anthropic, Google).

## Umfang
- Base interfaces und types definieren
- Provider registry pattern implementieren
- Configuration management
- Unified request/response format

## Tasks

### 1. Interface Definition
```typescript
// packages/ai-adapter/src/types.ts
interface AIProvider {
  name: string;
  initialize(config: ProviderConfig): Promise<void>;
  complete(prompt: CompletionRequest): Promise<CompletionResponse>;
  stream(prompt: CompletionRequest): AsyncIterableIterator<StreamChunk>;
  embed(text: string): Promise<number[]>;
  validateConfig(): boolean;
}

interface CompletionRequest {
  messages: Message[];
  model?: string;
  temperature?: number;
  maxTokens?: number;
  systemPrompt?: string;
  tools?: Tool[];
}

interface CompletionResponse {
  content: string;
  usage?: TokenUsage;
  model: string;
  finishReason?: string;
  toolCalls?: ToolCall[];
}
```

### 2. Provider Registry
```typescript
// packages/ai-adapter/src/registry.ts
class ProviderRegistry {
  private providers: Map<string, AIProvider>;
  
  register(name: string, provider: AIProvider): void;
  get(name: string): AIProvider | undefined;
  list(): string[];
  setDefault(name: string): void;
}
```

### 3. Base Provider Class
```typescript
// packages/ai-adapter/src/base-provider.ts
abstract class BaseAIProvider implements AIProvider {
  protected config: ProviderConfig;
  protected client: any;
  
  abstract initialize(config: ProviderConfig): Promise<void>;
  abstract complete(prompt: CompletionRequest): Promise<CompletionResponse>;
  
  // Gemeinsame utility methods
  protected normalizeMessages(messages: Message[]): any;
  protected handleError(error: any): never;
}
```

### 4. Configuration Management
```typescript
// packages/ai-adapter/src/config.ts
interface AIAdapterConfig {
  defaultProvider?: string;
  providers: {
    openai?: OpenAIConfig;
    anthropic?: AnthropicConfig;
    google?: GoogleConfig;
  };
  retryConfig?: RetryConfig;
  logging?: LoggingConfig;
}
```

## Dateien zu erstellen/ändern
- `packages/ai-adapter/src/types.ts` - Type definitions
- `packages/ai-adapter/src/base-provider.ts` - Abstract base class
- `packages/ai-adapter/src/registry.ts` - Provider registry
- `packages/ai-adapter/src/config.ts` - Configuration types
- `packages/ai-adapter/src/index.ts` - Main exports

## Akzeptanzkriterien
- [ ] Alle interfaces sind vollständig typisiert
- [ ] Provider registry funktioniert mit add/get/list
- [ ] Base provider class hat gemeinsame functionality
- [ ] Configuration kann aus environment variables geladen werden
- [ ] TypeScript build ohne Fehler
- [ ] Basis für provider-spezifische Implementierungen geschaffen

## Abhängigkeiten
- TypeScript configuration
- Package.json setup
- Zod für config validation (optional)

## Geschätzter Aufwand
45-60 Minuten