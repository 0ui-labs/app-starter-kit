# Task 09.09.1: E2E Tests - Homepage und öffentliche Seiten

## Ziel
Implementierung von End-to-End Tests für die Homepage und alle öffentlichen Seiten mit Playwright. Sicherstellen, dass alle Seiten korrekt laden, responsive sind und keine Konsolenfehler aufweisen.

## Voraussetzungen
- Task 09.08 abgeschlossen (Playwright konfiguriert)
- Development Server läuft
- Test Helpers verfügbar

## Implementierung

### Schritt 1: Homepage Tests
Erstelle `e2e/homepage.spec.ts`:

```typescript
import { test, expect } from '@playwright/test';
import { TestHelpers } from './helpers/test-helpers';

test.describe('Homepage', () => {
  let helpers: TestHelpers;

  test.beforeEach(async ({ page }) => {
    helpers = new TestHelpers(page);
    await page.goto('/');
  });

  test('has correct title and meta tags', async ({ page }) => {
    // Check title
    await expect(page).toHaveTitle(/App Starter Kit/);
    
    // Check meta description
    const metaDescription = await page.locator('meta[name="description"]').getAttribute('content');
    expect(metaDescription).toContain('starter kit');
    
    // Check Open Graph tags
    const ogTitle = await page.locator('meta[property="og:title"]').getAttribute('content');
    expect(ogTitle).toBeDefined();
  });

  test('displays hero section', async ({ page }) => {
    // Check hero heading
    const heading = page.locator('h1');
    await expect(heading).toBeVisible();
    await expect(heading).toContainText(/Welcome|Get Started|Build/i);
    
    // Check CTA buttons
    const ctaButton = page.locator('a[href="/sign-up"], button:has-text("Get Started")').first();
    await expect(ctaButton).toBeVisible();
  });

  test('navigation menu works', async ({ page }) => {
    // Check navigation links
    const nav = page.locator('nav');
    await expect(nav).toBeVisible();
    
    // Test navigation items
    const links = [
      { text: 'Features', href: '/features' },
      { text: 'Pricing', href: '/pricing' },
      { text: 'About', href: '/about' },
      { text: 'Sign In', href: '/sign-in' },
    ];
    
    for (const link of links) {
      const navLink = nav.locator(`a:has-text("${link.text}")`);
      await expect(navLink).toBeVisible();
      await expect(navLink).toHaveAttribute('href', link.href);
    }
  });

  test('responsive mobile menu', async ({ page }) => {
    // Set mobile viewport
    await page.setViewportSize({ width: 375, height: 667 });
    
    // Mobile menu button should be visible
    const menuButton = page.locator('[aria-label="Menu"], [data-testid="mobile-menu-button"]');
    await expect(menuButton).toBeVisible();
    
    // Open mobile menu
    await menuButton.click();
    
    // Menu should be visible
    const mobileMenu = page.locator('[role="dialog"], [data-testid="mobile-menu"]');
    await expect(mobileMenu).toBeVisible();
    
    // Check menu items
    await expect(mobileMenu.locator('a:has-text("Features")')).toBeVisible();
  });

  test('footer links and information', async ({ page }) => {
    // Scroll to footer
    const footer = page.locator('footer');
    await footer.scrollIntoViewIfNeeded();
    await expect(footer).toBeVisible();
    
    // Check footer links
    const footerLinks = [
      'Privacy Policy',
      'Terms of Service',
      'Contact',
    ];
    
    for (const linkText of footerLinks) {
      await expect(footer.locator(`a:has-text("${linkText}")`)).toBeVisible();
    }
    
    // Check copyright
    await expect(footer).toContainText(/© \d{4}/);
  });

  test('page loads quickly', async ({ page }) => {
    const startTime = Date.now();
    await page.goto('/', { waitUntil: 'domcontentloaded' });
    const loadTime = Date.now() - startTime;
    
    expect(loadTime).toBeLessThan(3000); // Should load in under 3 seconds
  });

  test('no console errors', async ({ page }) => {
    const errors: string[] = [];
    page.on('console', msg => {
      if (msg.type() === 'error') {
        errors.push(msg.text());
      }
    });
    
    await page.goto('/');
    await page.waitForLoadState('networkidle');
    
    expect(errors).toHaveLength(0);
  });
});
```

### Schritt 2: Public Pages Tests
Erstelle `e2e/public-pages.spec.ts`:

```typescript
import { test, expect } from '@playwright/test';

test.describe('Public Pages', () => {
  test('pricing page loads correctly', async ({ page }) => {
    await page.goto('/pricing');
    
    // Check page title
    await expect(page.locator('h1')).toContainText(/Pricing|Plans/i);
    
    // Check pricing cards exist
    const pricingCards = page.locator('[data-testid="pricing-card"]');
    await expect(pricingCards).toHaveCount(await pricingCards.count());
    
    // Check CTA buttons
    const ctaButtons = page.locator('button:has-text("Get Started"), a:has-text("Choose Plan")');
    expect(await ctaButtons.count()).toBeGreaterThan(0);
  });

  test('about page loads correctly', async ({ page }) => {
    await page.goto('/about');
    
    // Check page content
    await expect(page.locator('h1')).toContainText(/About/i);
    
    // Check team section or company info
    const contentSections = page.locator('section');
    expect(await contentSections.count()).toBeGreaterThan(0);
  });

  test('features page loads correctly', async ({ page }) => {
    await page.goto('/features');
    
    // Check page title
    await expect(page.locator('h1')).toContainText(/Features/i);
    
    // Check feature cards or list
    const features = page.locator('[data-testid="feature-item"]');
    expect(await features.count()).toBeGreaterThan(0);
  });

  test('404 page handles unknown routes', async ({ page }) => {
    await page.goto('/non-existent-page');
    
    // Should show 404 content
    await expect(page.locator('text=404, text=Not Found')).toBeVisible();
    
    // Should have link back to homepage
    const homeLink = page.locator('a[href="/"]');
    await expect(homeLink).toBeVisible();
  });

  test('privacy policy page', async ({ page }) => {
    await page.goto('/privacy');
    
    // Check page loads
    await expect(page.locator('h1')).toContainText(/Privacy/i);
    
    // Check content exists
    const content = page.locator('main, article');
    await expect(content).toBeVisible();
    await expect(content).toContainText(/data|information|privacy/i);
  });

  test('terms of service page', async ({ page }) => {
    await page.goto('/terms');
    
    // Check page loads
    await expect(page.locator('h1')).toContainText(/Terms/i);
    
    // Check content exists
    const content = page.locator('main, article');
    await expect(content).toBeVisible();
    await expect(content).toContainText(/terms|service|agreement/i);
  });
});
```

### Schritt 3: SEO und Performance Tests
Erstelle `e2e/seo-performance.spec.ts`:

```typescript
import { test, expect } from '@playwright/test';

test.describe('SEO and Performance', () => {
  test('has proper SEO meta tags', async ({ page }) => {
    await page.goto('/');
    
    // Check essential meta tags
    const viewport = await page.locator('meta[name="viewport"]').getAttribute('content');
    expect(viewport).toContain('width=device-width');
    
    // Check canonical URL
    const canonical = await page.locator('link[rel="canonical"]').getAttribute('href');
    expect(canonical).toBeDefined();
    
    // Check robots meta
    const robots = await page.locator('meta[name="robots"]').getAttribute('content');
    expect(robots).toBeDefined();
  });

  test('has structured data', async ({ page }) => {
    await page.goto('/');
    
    // Check for JSON-LD structured data
    const structuredData = await page.locator('script[type="application/ld+json"]').textContent();
    if (structuredData) {
      const data = JSON.parse(structuredData);
      expect(data['@context']).toBe('https://schema.org');
      expect(data['@type']).toBeDefined();
    }
  });

  test('images have proper attributes', async ({ page }) => {
    await page.goto('/');
    
    const images = await page.locator('img').all();
    for (const img of images) {
      // Check alt text
      const alt = await img.getAttribute('alt');
      expect(alt).toBeDefined();
      
      // Check loading attribute for performance
      const loading = await img.getAttribute('loading');
      // Important images should load eagerly, others lazy
      expect(['lazy', 'eager', null]).toContain(loading);
      
      // Check width and height for CLS
      const width = await img.getAttribute('width');
      const height = await img.getAttribute('height');
      expect(width || height).toBeTruthy();
    }
  });

  test('has proper heading hierarchy', async ({ page }) => {
    await page.goto('/');
    
    // Should have exactly one h1
    const h1Count = await page.locator('h1').count();
    expect(h1Count).toBe(1);
    
    // Check heading order
    const headings = await page.locator('h1, h2, h3, h4, h5, h6').all();
    let lastLevel = 0;
    
    for (const heading of headings) {
      const tagName = await heading.evaluate(el => el.tagName);
      const level = parseInt(tagName.substring(1));
      
      // Level should not skip (e.g., h1 -> h3)
      expect(level - lastLevel).toBeLessThanOrEqual(1);
      lastLevel = level;
    }
  });
});
```

## Verifizierung

### Test 1: Run Homepage Tests
```bash
npx playwright test homepage.spec.ts
# Alle Homepage Tests sollten grün sein
```

### Test 2: Run Public Pages Tests
```bash
npx playwright test public-pages.spec.ts
# Alle öffentlichen Seiten Tests sollten grün sein
```

### Test 3: Run SEO Tests
```bash
npx playwright test seo-performance.spec.ts
# SEO und Performance Tests sollten grün sein
```

### Test 4: Visual Regression Testing
```bash
npx playwright test --update-snapshots
# Erstellt Screenshots für Visual Tests
```

## Erfolgskriterien
- [ ] Homepage lädt korrekt mit allen Elementen
- [ ] Navigation funktioniert auf Desktop und Mobile
- [ ] Alle öffentlichen Seiten sind erreichbar
- [ ] SEO Meta-Tags sind vorhanden
- [ ] Keine JavaScript-Fehler in der Konsole
- [ ] Ladezeit unter 3 Sekunden
- [ ] Responsive Design funktioniert
- [ ] Footer Links funktionieren
- [ ] 404 Seite funktioniert korrekt

## Wichtige Hinweise

### Mobile Testing
- Verschiedene Viewport-Größen testen
- Touch-Gesten berücksichtigen
- Mobile-spezifische Features prüfen

### Performance Monitoring
- Core Web Vitals messen
- Ladezeiten überwachen
- Bundle-Größe im Auge behalten

### Cross-Browser Testing
```typescript
// In playwright.config.ts verschiedene Browser konfigurieren
projects: [
  { name: 'chromium' },
  { name: 'firefox' },
  { name: 'webkit' },
]
```

## Potentielle Probleme

### Problem: Flaky Tests bei Animationen
**Lösung**: Animationen für Tests deaktivieren
```typescript
await page.addStyleTag({
  content: '*, *::before, *::after { animation-duration: 0s !important; }'
});
```

### Problem: External Resources langsam
**Lösung**: Network Mocking verwenden
```typescript
await page.route('https://cdn.example.com/**', route => route.abort());
```

## Zeitschätzung
- Homepage Tests: 5 Minuten
- Public Pages Tests: 5 Minuten
- SEO Tests: 3 Minuten
- Verifizierung: 2 Minuten
- **Total: 15 Minuten**

## Nächster Schritt
Nach erfolgreichen Homepage Tests → [09.09.2 Authentication Flow E2E Tests](./09.09.2-e2e-authentication-flow.md)