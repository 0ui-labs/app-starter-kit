# Arbeitspaket 03.01.1: User Management Schema

## Ziel
Implementierung des User Management Bereichs im Prisma Schema mit User, Profile und Session Models.

## Kontext
- **Package**: `@starter-kit/db`
- **Schema Location**: `packages/db/prisma/schema.prisma`
- **Database**: PostgreSQL (Neon in Production)
- **Teil von**: Arbeitspaket 03.01 - Prisma Schema Implementation

## Implementierung

### 1. Enums für User Management

```prisma
enum UserRole {
  USER
  ADMIN
  MODERATOR
}

enum UserStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
  DELETED
}
```

### 2. User Model

```prisma
model User {
  id              String      @id @default(uuid())
  email           String      @unique
  name            String?
  role            UserRole    @default(USER)
  status          UserStatus  @default(ACTIVE)
  emailVerified   DateTime?
  image           String?
  
  // Clerk Integration
  clerkId         String?     @unique
  
  // Profile
  profile         Profile?
  
  // Relations (zu anderen Models)
  posts           Post[]
  comments        Comment[]
  sessions        Session[]
  auditLogs       AuditLog[]
  
  // Timestamps
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  deletedAt       DateTime?   // Soft Delete Support
  
  // Indexes für Performance
  @@index([email])
  @@index([clerkId])
  @@index([status])
  @@index([createdAt])
  @@map("users")
}
```

### 3. Profile Model

```prisma
model Profile {
  id              String      @id @default(uuid())
  userId          String      @unique
  user            User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Profile Data
  bio             String?
  website         String?
  location        String?
  company         String?
  
  // Social Links
  twitter         String?
  github          String?
  linkedin        String?
  
  // Settings & Preferences (JSON für Flexibilität)
  settings        Json        @default("{}")
  preferences     Json        @default("{}")
  
  // Timestamps
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  
  @@map("profiles")
}
```

### 4. Session Model

```prisma
model Session {
  id              String      @id @default(uuid())
  userId          String
  user            User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  token           String      @unique
  userAgent       String?
  ip              String?
  
  expiresAt       DateTime
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  
  // Indexes für schnelle Lookups
  @@index([userId])
  @@index([token])
  @@index([expiresAt])
  @@map("sessions")
}
```

## Key Features

### Clerk Integration
- `clerkId` Field im User Model für nahtlose Clerk Authentication
- Unique Constraint für Clerk ID

### Soft Delete Support
- `deletedAt` Field für Soft Deletes
- Ermöglicht Datenwiederherstellung und Audit-Compliance

### Profile Separation
- Trennung von User (Auth) und Profile (Business Data)
- 1:1 Beziehung mit Cascade Delete

### Session Management
- Token-basierte Sessions
- IP und User Agent Tracking für Security
- Automatisches Cleanup über `expiresAt`

### Performance Optimierung
- Indexes auf häufig abgefragte Felder
- Composite Indexes für komplexe Queries

## Verifizierung

```bash
# Schema validieren
cd packages/db
npx prisma validate

# Migration erstellen (nur dieser Teil)
npx prisma migrate dev --name add-user-management
```

## Abhängigkeiten
- Clerk Authentication Setup (für clerkId Integration)
- PostgreSQL Database

## Erfolgskriterien
- [ ] User Model mit allen Feldern implementiert
- [ ] Profile Model mit 1:1 Relation zu User
- [ ] Session Model für Token Management
- [ ] Alle Indexes für Performance
- [ ] Soft Delete Support vorbereitet
- [ ] Clerk Integration Fields vorhanden
- [ ] Schema Validation erfolgreich