# Teilaufgabe 01.04: Environment Example File Update

## Ziel
Erstellung und Pflege einer vollst√§ndigen `.env.example` Datei als Dokumentation und Template f√ºr alle Environment Variables mit hilfreichen Kommentaren und Beispielwerten.

## Zeitsch√§tzung
‚è±Ô∏è **5 Minuten**

## Voraussetzungen
- [01.02 Environment Configuration](./01.02-environment-configuration.md) abgeschlossen
- Verst√§ndnis aller definierten Environment Variables
- Zugriff auf `apps/web/` Directory

## File Location
```
apps/web/.env.example
```

## Implementation

### Schritt 1: Create/Update .env.example

```bash
# Navigate to web app
cd apps/web

# Create or overwrite .env.example
cat > .env.example << 'EOF'
# ============================================
# App Starter Kit - Environment Variables
# ============================================
# Copy this file to .env.local for development
# All REQUIRED variables must be set for the app to start
# ============================================

# ============================================
# üî¥ REQUIRED: Database Configuration
# ============================================

# PostgreSQL Database URL
# Get your free database from https://neon.tech or https://supabase.com
# Format: postgresql://[user]:[password]@[host]/[database]?sslmode=require
DATABASE_URL="postgresql://user:password@ep-example.region.aws.neon.tech/dbname?sslmode=require"

# ============================================
# üî¥ REQUIRED: Authentication (Clerk)
# ============================================

# Clerk Secret Key (Server-side)
# Get from: https://dashboard.clerk.com/apps/[app-id]/instances/[instance-id]/api-keys
CLERK_SECRET_KEY="sk_test_XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"

# Clerk Publishable Key (Client-side)
# Get from: https://dashboard.clerk.com/apps/[app-id]/instances/[instance-id]/api-keys
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY="pk_test_XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"

# ============================================
# üü° OPTIONAL: Clerk Configuration
# ============================================

# Clerk Routes (defaults provided if not set)
NEXT_PUBLIC_CLERK_SIGN_IN_URL="/sign-in"
NEXT_PUBLIC_CLERK_SIGN_UP_URL="/sign-up"
NEXT_PUBLIC_CLERK_AFTER_SIGN_IN_URL="/dashboard"
NEXT_PUBLIC_CLERK_AFTER_SIGN_UP_URL="/dashboard"

# Clerk Webhook Secret (for production webhooks)
# Get from: https://dashboard.clerk.com/apps/[app-id]/instances/[instance-id]/webhooks
# CLERK_WEBHOOK_SECRET="whsec_XXXXXXXXXXXXXXXXXXXXXXXXX"

# ============================================
# üü° OPTIONAL: AI Features
# ============================================

# OpenAI API Key (for AI-powered features)
# Get from: https://platform.openai.com/api-keys
# OPENAI_API_KEY="sk-XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"

# ============================================
# üü° OPTIONAL: Application Configuration
# ============================================

# Application Port (default: 3004)
PORT=3004

# Node Environment (development | production | test)
NODE_ENV="development"

# Public App URL (for meta tags, redirects, webhooks)
# Local: http://localhost:3004
# Production: https://your-domain.com
NEXT_PUBLIC_APP_URL="http://localhost:3004"

# ============================================
# üü° OPTIONAL: Feature Flags
# ============================================

# Enable Analytics (true | false)
# NEXT_PUBLIC_ENABLE_ANALYTICS="false"

# ============================================
# üü° OPTIONAL: Monitoring & Observability
# ============================================

# Sentry Error Tracking
# Get from: https://sentry.io/settings/[org]/projects/[project]/keys/
# SENTRY_DSN="https://XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX@oXXXXXXX.ingest.sentry.io/XXXXXXXXX"
# SENTRY_AUTH_TOKEN="sntrys_XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"

# ============================================
# üü° OPTIONAL: Rate Limiting
# ============================================

# Upstash Redis (for rate limiting)
# Get from: https://console.upstash.com/redis
# UPSTASH_REDIS_REST_URL="https://XXXXX-XXXXX-XXXXX.upstash.io"
# UPSTASH_REDIS_REST_TOKEN="XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"

# ============================================
# ‚öôÔ∏è BUILD & DEPLOYMENT FLAGS
# ============================================

# Skip environment validation during build (CI/CD)
# SKIP_ENV_VALIDATION="true"

# Build standalone output for Docker
# BUILD_STANDALONE="true"

# Docker build flag
# DOCKER_BUILD="true"

# Validate environment at runtime (for Docker)
# VALIDATE_ENV_AT_RUNTIME="true"

# Strict environment validation in production
# STRICT_ENV="true"

# ============================================
# üìù NOTES
# ============================================
# 
# 1. Required variables are marked with üî¥
# 2. Optional variables are marked with üü°
# 3. Never commit .env or .env.local files
# 4. Use different values for production
# 5. Rotate keys regularly for security
# 6. All NEXT_PUBLIC_* variables are exposed to the browser
#
# For help, see: https://github.com/yourusername/app-starter-kit#environment-variables
# ============================================
EOF

echo "‚úÖ .env.example created successfully"
```

### Schritt 2: Create Development .env Template

```bash
# Create a minimal .env for quick start
cat > .env.local.template << 'EOF'
# Minimal .env for local development
# Rename to .env.local and fill in your values

DATABASE_URL=""
CLERK_SECRET_KEY=""
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=""
EOF

echo "‚úÖ .env.local.template created"
```

### Schritt 3: Update .gitignore

```bash
# Ensure .env files are ignored
cat >> .gitignore << 'EOF'

# Environment files
.env
.env.local
.env.production
.env.*.local

# Keep example files
!.env.example
!.env.local.template
EOF

echo "‚úÖ .gitignore updated"
```

## Documentation Sections

### Required Variables Section
Diese Variables M√úSSEN gesetzt werden:
- `DATABASE_URL` - PostgreSQL Connection String
- `CLERK_SECRET_KEY` - Server-side Authentication
- `NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY` - Client-side Authentication

### Optional Variables Section
Diese Variables k√∂nnen gesetzt werden f√ºr zus√§tzliche Features:
- OpenAI API f√ºr AI Features
- Sentry f√ºr Error Tracking
- Upstash Redis f√ºr Rate Limiting
- Feature Flags f√ºr A/B Testing

### Build Flags Section
Spezielle Flags f√ºr CI/CD und Deployment:
- `SKIP_ENV_VALIDATION` - √úberspringt Validation beim Build
- `BUILD_STANDALONE` - Erstellt standalone Output f√ºr Docker
- `DOCKER_BUILD` - Signalisiert Docker Build Kontext

## Best Practices

### 1. Security Guidelines
```bash
# ‚ùå NEVER commit real values
DATABASE_URL="postgresql://real:password@real-host/db"  # DON'T DO THIS

# ‚úÖ Use placeholder values
DATABASE_URL="postgresql://user:password@host/database?sslmode=require"  # GOOD
```

### 2. Helpful Comments
```bash
# Include service links
# Get from: https://dashboard.clerk.com/...

# Include format examples
# Format: postgresql://[user]:[password]@[host]/[database]

# Include default values
# Default: 3004
PORT=3004
```

### 3. Grouping & Organization
```bash
# Group related variables together
# Use visual separators
# Order by importance (required ‚Üí optional ‚Üí build flags)
```

## Validation Helper Script

Create `apps/web/scripts/check-env.js`:

```javascript
#!/usr/bin/env node

const fs = require('fs');
const path = require('path');

const envPath = path.join(__dirname, '..', '.env.local');
const examplePath = path.join(__dirname, '..', '.env.example');

if (!fs.existsSync(envPath)) {
  console.error('‚ùå .env.local not found!');
  console.log('üìù Create it by copying .env.example:');
  console.log('   cp .env.example .env.local');
  process.exit(1);
}

const env = fs.readFileSync(envPath, 'utf-8');
const required = [
  'DATABASE_URL',
  'CLERK_SECRET_KEY',
  'NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY'
];

const missing = required.filter(key => !env.includes(`${key}=`));

if (missing.length > 0) {
  console.error('‚ùå Missing required environment variables:');
  missing.forEach(key => console.log(`   - ${key}`));
  process.exit(1);
}

console.log('‚úÖ All required environment variables are set!');
```

Add to package.json:
```json
{
  "scripts": {
    "env:check": "node scripts/check-env.js"
  }
}
```

## Testing the .env.example

### Test 1: Copy and Use
```bash
cd apps/web
# Copy example to .env.local
cp .env.example .env.local

# Edit with real values
nano .env.local

# Test if app starts
npm run dev
```

### Test 2: Completeness Check
```bash
# Compare with env.ts schema
# Every variable in env.ts should be in .env.example
grep -E "^\s+[A-Z_]+:" src/env.ts | sed 's/:.*//' | sort > /tmp/env-schema.txt
grep -E "^[A-Z_]+=" .env.example | sed 's/=.*//' | sort > /tmp/env-example.txt
diff /tmp/env-schema.txt /tmp/env-example.txt
```

### Test 3: Documentation Quality
Checklist:
- [ ] Every variable has a comment
- [ ] Links to services provided
- [ ] Format examples included
- [ ] Required vs Optional clearly marked
- [ ] Security warnings present

## Maintenance

### When to Update .env.example
1. When adding new environment variable to `env.ts`
2. When changing default values
3. When adding new external services
4. When deprecating variables

### Update Process
```bash
# 1. Update env.ts with new variable
# 2. Update .env.example with documentation
# 3. Update README if needed
# 4. Commit both files together
git add src/env.ts .env.example
git commit -m "feat: Add NEW_VARIABLE environment variable"
```

## Success Criteria
- ‚úÖ .env.example exists with all variables
- ‚úÖ Clear documentation for each variable
- ‚úÖ Service URLs included where relevant
- ‚úÖ Required vs Optional clearly marked
- ‚úÖ Security warnings present
- ‚úÖ .gitignore updated to protect secrets

## Common Mistakes to Avoid
1. ‚ùå Committing real API keys in example
2. ‚ùå Missing variables from example
3. ‚ùå No format documentation
4. ‚ùå No links to obtain keys
5. ‚ùå Unclear required vs optional

## Next Steps
Nach erfolgreicher .env.example Erstellung ‚Üí [01.05 Testing & Verification](./01.05-testing-verification.md)