# Arbeitspaket 03.01.2: Content Management Schema

## Ziel
Implementierung des Content Management Bereichs im Prisma Schema mit Post, Comment und Tag Models.

## Kontext
- **Package**: `@starter-kit/db`
- **Schema Location**: `packages/db/prisma/schema.prisma`
- **Database**: PostgreSQL (Neon in Production)
- **Teil von**: Arbeitspaket 03.01 - Prisma Schema Implementation
- **Abhängigkeit**: User Management Schema (03.01.1)

## Implementierung

### 1. Post Model

```prisma
model Post {
  id              String      @id @default(uuid())
  authorId        String
  author          User        @relation(fields: [authorId], references: [id], onDelete: Cascade)
  
  // Content Fields
  title           String
  slug            String      @unique
  content         String
  excerpt         String?
  
  // Publishing
  published       Boolean     @default(false)
  publishedAt     DateTime?
  
  // SEO Fields
  metaTitle       String?
  metaDescription String?
  metaKeywords    String[]    // Array von Keywords
  
  // Relations
  tags            Tag[]       // Many-to-Many
  comments        Comment[]   // One-to-Many
  
  // Engagement Stats
  views           Int         @default(0)
  likes           Int         @default(0)
  
  // Timestamps
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  deletedAt       DateTime?   // Soft Delete
  
  // Performance Indexes
  @@index([authorId])
  @@index([slug])
  @@index([published])
  @@index([publishedAt])
  @@index([createdAt])
  @@map("posts")
}
```

### 2. Comment Model

```prisma
model Comment {
  id              String      @id @default(uuid())
  postId          String
  post            Post        @relation(fields: [postId], references: [id], onDelete: Cascade)
  authorId        String
  author          User        @relation(fields: [authorId], references: [id], onDelete: Cascade)
  
  // Comment Content
  content         String
  
  // Nested Comments Support (Self-Referencing)
  parentId        String?
  parent          Comment?    @relation("CommentReplies", fields: [parentId], references: [id], onDelete: Cascade)
  replies         Comment[]   @relation("CommentReplies")
  
  // Moderation Features
  approved        Boolean     @default(true)
  flagged         Boolean     @default(false)
  
  // Timestamps
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  deletedAt       DateTime?   // Soft Delete
  
  // Indexes für Performance
  @@index([postId])
  @@index([authorId])
  @@index([parentId])
  @@index([approved])
  @@map("comments")
}
```

### 3. Tag Model

```prisma
model Tag {
  id              String      @id @default(uuid())
  name            String      @unique
  slug            String      @unique
  description     String?
  
  // Many-to-Many Relation mit Posts
  posts           Post[]
  
  // Timestamps
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  
  // Index für schnelle Slug-Lookups
  @@index([slug])
  @@map("tags")
}
```

## Key Features

### Slug-basierte URLs
- Unique Slugs für Posts und Tags
- SEO-freundliche URLs
- Automatische Slug-Generierung empfohlen

### Hierarchische Kommentare
- Self-referencing für Thread-Diskussionen
- Unbegrenzte Verschachtelungstiefe
- Cascade Delete für Antworten

### Moderation System
- `approved` Flag für Kommentar-Moderation
- `flagged` für problematische Inhalte
- Soft Delete für Content Recovery

### SEO Optimierung
- Meta-Fields für Posts
- Keywords als Array
- Strukturierte Daten Support

### Publishing Workflow
- Draft/Published Status
- Scheduled Publishing via `publishedAt`
- Versionierung möglich durch Soft Deletes

### Engagement Tracking
- View Counter
- Like Counter
- Basis für Analytics

## Beziehungen

### Post ↔ User
- Many-to-One: Viele Posts pro User
- Cascade Delete: User löschen → Posts löschen

### Post ↔ Tag
- Many-to-Many: Implicit durch Prisma
- Flexible Kategorisierung

### Post ↔ Comment
- One-to-Many: Viele Kommentare pro Post
- Cascade Delete für Cleanup

### Comment ↔ Comment
- Self-referencing für Replies
- Threaded Discussions

## Verifizierung

```bash
# Schema validieren
cd packages/db
npx prisma validate

# Migration erstellen (nur dieser Teil)
npx prisma migrate dev --name add-content-management

# Prisma Studio öffnen zum Testen
npx prisma studio
```

## Performance Überlegungen

### Indexes
- `slug`: Schnelle URL-Auflösung
- `published` + `publishedAt`: Filterung öffentlicher Posts
- `authorId`: User-spezifische Queries
- `approved`: Kommentar-Filterung

### Datenbank-Optimierungen
- Pagination für große Comment-Threads
- Eager Loading für Tags vermeiden
- View Counter async updaten

## Erfolgskriterien
- [ ] Post Model mit allen Content-Feldern
- [ ] Comment Model mit Hierarchie-Support
- [ ] Tag Model für Kategorisierung
- [ ] SEO-Fields implementiert
- [ ] Moderation Features vorhanden
- [ ] Alle Relations korrekt definiert
- [ ] Performance Indexes gesetzt
- [ ] Soft Delete Support für alle Models