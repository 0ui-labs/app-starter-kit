# Arbeitspaket 14.03: Prometheus Metrics Collection

## Ziel
Implementierung eines Metrics Collection Systems mit prom-client für Prometheus-kompatible Metriken inklusive HTTP, Database und Business Metrics.

## Umfang
- prom-client Setup mit Custom Registry
- Default Metrics (CPU, Memory, GC)
- HTTP Request Metrics
- Database Query Metrics
- Business Metrics (User Registrations, etc.)
- AI Request Metrics
- Metrics Endpoint für Prometheus Scraping

## Implementierung

### 1. Dependencies installieren
```bash
npm install prom-client
```

### 2. Metrics Registry Setup
`packages/api/src/metrics/index.ts`:
- Custom Registry erstellen
- Default Labels setzen
- Default Metrics aktivieren

### 3. Metric Types implementieren
- **Counters**: Total Requests, Registrations, AI Tokens
- **Histograms**: Request Duration, Query Duration
- **Gauges**: Active Connections

### 4. Middleware für HTTP Metrics
- Request Duration Tracking
- Status Code Counting
- Route-basierte Metrics

### 5. Metrics Endpoint
`apps/web/src/app/api/metrics/route.ts`:
- Prometheus Text Format Export
- Optional Authentication
- Proper Content-Type Headers

## Erfolgskriterien
- [ ] prom-client installiert und konfiguriert
- [ ] Default Metrics werden gesammelt
- [ ] HTTP Request Metrics funktionieren
- [ ] Database Query Metrics werden getrackt
- [ ] Business Metrics implementiert
- [ ] AI Usage Metrics verfügbar
- [ ] `/api/metrics` Endpoint funktioniert
- [ ] Metrics im Prometheus Format

## Zeitschätzung
25 Minuten